<?php declare(strict_types=1);
/**
 * This file is part of student-assignment-scheduler.
 *
 * Copywright (c) Eric Fortmeyer.
 * Licensed under the MIT License. See LICENSE in the project root folder for license information.
 *
 * @author Eric Fortmeyer <e.fortmeyer01@gmail.com>
 */

namespace StudentAssignmentScheduler\Parsing;

class RtfPage
{
    /**
     * @var string
     */
    protected $text = "";

    public function __construct(string $text)
    {
        $this->text = $text;
    }

    public function getText(): string
    {
        return $this->withBackwardsCompatibleDateAppended($this->text);
    }

    protected function doesNotHaveSchedule(string $text): bool
    {
        return strlen($text) < 400;
    }

    protected function withBackwardsCompatibleDateAppended(string $text): string
    {
        $backwards_compatible_date = implode(" ", $this->parseDate($text));
        
        return $text . $backwards_compatible_date;
    }

    protected function parseDate(string $text): array
    {
        $date = "/\\\\b\s{1}(\w{3,9})\\\\u160\?(\d{1,2})(?:-|\\\\u8211\?)(?:[\w]{3,9}|\d{1,2})/";

        preg_match($date, $text, $matches);

        return [
            // prepend the newline to be compatible with pdf parser
            "month" => "\n" . strtoupper($matches[1]),
            "day" => $matches[2]
        ];
    }
}

